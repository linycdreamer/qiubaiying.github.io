<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>- ROS</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><hr><p data-anchor-id="dnz6">layout:     post <br>
title:      ROS基础教程 <br>
subtitle:   ROS学习之路 <br>
date:       2018-09-23 <br>
author:     linyicheng <br>
header-img: img/air-84675_1280.jpg <br>
catalog: true <br>
<code></code></p><div class="md-section-divider"></div><h2 data-anchor-id="ob8p" id="ros">    - ROS</h2><div class="md-section-divider"></div><h1 data-anchor-id="e6j4" id="前言">前言</h1><p data-anchor-id="p7yf">学习ros最好的教程便是维基百科，但是要注意一点便是中文的维基百科比较的旧特别容易出问题。还是推荐使用英文的维基百科，英文不好的同学可以用谷歌翻译（虽然翻译的水平很烂，但是可以中英文对照着看），推荐一个好办法就是看中文的维基但是命令都用英文版的维基上面的。当然对英文很反感的同学也可以看这里创客制造翻译的教程 <br>
闲话不多说，我的环境是Ubuntu14.04 ros和indigo。安装教程很多，也比较简单就不详细说明。</p><hr><div class="md-section-divider"></div><h3 data-anchor-id="0y5p" id="创建ros包">创建ROS包</h3><ol data-anchor-id="7amj">
<li><p>创建catkin工作空间</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">   source </span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">ros</span><span class="pun">/</span><span class="pln">indigo</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash</span></code></li><li class="L2"><code><span class="pln">   mkdir </span><span class="pun">-</span><span class="pln">p </span><span class="pun">~</span><span class="str">/mudu/</span><span class="pln">src</span></code></li><li class="L3"><code><span class="pln">   cd </span><span class="pun">~</span><span class="str">/mudu/</span></code></li><li class="L4"><code><span class="pln">   catkin_make</span></code></li><li class="L5"><code><span class="pln">   source devel</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash </span></code></li></ol></pre>

<p>这样我们就新建了一个catkin工作空间</p></li>
<li><p>创建catkin包</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">   cd src</span><span class="pun">/</span></code></li><li class="L2"><code><span class="pln">   catkin_create_pkg robot std_msgs rospy roscpp</span></code></li><li class="L3"><code><span class="pln">   cd </span><span class="pun">..</span></code></li><li class="L4"><code><span class="pln">   catkin_make</span></code></li></ol></pre>

<p>这样我们就成功创建了一个包含std_msgs rospy roscpp的catkin包，接下来我们验证一下是否成功 <br>
输入</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">   rospack depends1 robot</span></code></li></ol></pre>

<p>如果出现，说明创建成功了。你可以继续下面的操作，如果不行只能重新来一次，可能某一步出错了，也可以参考维基百科</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">   </span><span class="pun">~/</span><span class="pln">mudu$ rospack depends1 robot</span></code></li><li class="L1"><code><span class="pln">   roscpp</span></code></li><li class="L2"><code><span class="pln">   rospy</span></code></li><li class="L3"><code><span class="pln">   std_msgs</span></code></li></ol></pre></li>
</ol><div class="md-section-divider"></div><h3 data-anchor-id="lfts" id="编译ros程序包">编译ros程序包</h3><ol data-anchor-id="fmvk">
<li><p>这一步十分便捷，只需要cd到最外层的目录下，然后</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">catkin_make</span></code></li></ol></pre></li>
<li><p>输入命令ls出现三个文件夹，如果出错请确定当前已经source过。</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">ls</span></code></li><li class="L1"><code><span class="pln">build  devel  src</span></code></li></ol></pre></li>
</ol><div class="md-section-divider"></div><hr><div class="md-section-divider"></div><h3 data-anchor-id="zj9a" id="创建msg和srv">创建msg和srv</h3><ol data-anchor-id="g05f">
<li><p>创建msg <br>
进入robot路径  </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">roscd robot </span></code></li></ol></pre>

<p>创建一个Num.msg文件</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">mkdir msg</span></code></li><li class="L1"><code><span class="pln">echo </span><span class="str">"int64 num"</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> msg</span><span class="pun">/</span><span class="typ">Num</span><span class="pun">.</span><span class="pln">msg</span></code></li></ol></pre>

<p>更改package.xml，这个文件就在当前目录下可以ls看到 <br>
取消如下两行</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;build_depend&gt;</span><span class="pln">message_generation</span><span class="tag">&lt;/build_depend&gt;</span></code></li><li class="L1"><code><span class="com">&lt;!-- Use build_export_depend for packages you need in order to build against this package: --&gt;</span></code></li><li class="L2"><code><span class="com">&lt;!--   &lt;build_export_depend&gt;message_generation&lt;/build_export_depend&gt; --&gt;</span></code></li><li class="L3"><code><span class="com">&lt;!-- Use buildtool_depend for build tool packages: --&gt;</span></code></li><li class="L4"><code><span class="com">&lt;!--   &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt; --&gt;</span></code></li><li class="L5"><code><span class="com">&lt;!-- Use exec_depend for packages you need at runtime: --&gt;</span></code></li><li class="L6"><code><span class="tag">&lt;exec_depend&gt;</span><span class="pln">message_runtime</span><span class="tag">&lt;/exec_depend&gt;</span><span class="pln"> </span></code></li><li class="L7"><code><span class="pln">find_package(catkin REQUIRED COMPONENTS#在cmakelist下更改成如下形式</span></code></li><li class="L8"><code><span class="pln">roscpp</span></code></li><li class="L9"><code><span class="pln">rospy</span></code></li><li class="L0"><code><span class="pln">std_msgs</span></code></li><li class="L1"><code><span class="pln">message_generation</span></code></li><li class="L2"><code><span class="pln">)</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">##取消注释并改成下面的形式</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">add_message_files(</span></code></li><li class="L7"><code><span class="pln">FILES</span></code></li><li class="L8"><code><span class="pln">Message1.msg</span></code></li><li class="L9"><code><span class="pln">Message2.msg</span></code></li><li class="L0"><code><span class="pln">)</span></code></li><li class="L1"><code><span class="pln">add_message_files(</span></code></li><li class="L2"><code><span class="pln">FILES</span></code></li><li class="L3"><code><span class="pln">Num.msg</span></code></li><li class="L4"><code><span class="pln">)</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">##取消下面的注释</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">generate_messages(</span></code></li><li class="L9"><code><span class="pln">DEPENDENCIES</span></code></li><li class="L0"><code><span class="pln">std_msgs</span></code></li><li class="L1"><code><span class="pln">)</span></code></li></ol></pre>

<p>现在可以运行一下，观察是否正确</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">rosmsg show </span><span class="typ">Num</span></code></li></ol></pre>

<p>出现下面的结果说明正确</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln"> </span><span class="pun">~</span><span class="str">/robochengzi/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">robot$ rosmsg show </span><span class="typ">Num</span></code></li><li class="L3"><code><span class="pln">   </span><span class="pun">[</span><span class="pln">robot</span><span class="pun">/</span><span class="typ">Num</span><span class="pun">]:</span></code></li><li class="L4"><code><span class="pln">   int64 num</span></code></li></ol></pre></li>
<li><p>新建一个srv</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">roscd beginner_tutorials</span></code></li><li class="L1"><code><span class="pln">mkdir srv </span></code></li></ol></pre>

<p>这次我们使用复制的方式</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">roscp rospy_tutorials </span><span class="typ">AddTwoInts</span><span class="pun">.</span><span class="pln">srv srv</span><span class="pun">/</span><span class="typ">AddTwoInts</span><span class="pun">.</span><span class="pln">srv</span></code></li></ol></pre>

<p>同样我们要更改Cmakelist文件 <br>
找到如下代码</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="com"># add_service_files(</span></code></li><li class="L2"><code></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="com">#   FILES</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">#   Service1.srv</span></code></li><li class="L8"><code></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="com">#   Service2.srv</span></code></li><li class="L1"><code></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com"># )</span></code></li></ol></pre>

<p>改成</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="com">## Generate services in the 'srv' folder</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">add_service_files</span><span class="pun">(</span></code></li><li class="L4"><code><span class="pln">FILES</span></code></li><li class="L5"><code><span class="typ">AddTwoInts</span><span class="pun">.</span><span class="pln">srv</span></code></li><li class="L6"><code><span class="pun">)</span></code></li></ol></pre>

<p>下面检验一下我们的srv文件 <br>
输入</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">rossrv show robot</span><span class="pun">/</span><span class="typ">AddTwoInts</span></code></li></ol></pre>

<p>如果看见   </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">  </span><span class="pun">~</span><span class="str">/mudu/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">robot$ rossrv show robot</span><span class="pun">/</span><span class="typ">AddTwoInts</span><span class="pln"> </span></code></li><li class="L3"><code><span class="pln">   int64 a</span></code></li><li class="L4"><code><span class="pln">   int64 b</span></code></li><li class="L5"><code><span class="pln">   </span><span class="pun">--</span><span class="pln">  </span></code></li><li class="L6"><code><span class="pln">   int64 sum</span></code></li></ol></pre></li>
</ol><div class="md-section-divider"></div><h2 data-anchor-id="wa49" id="说明正常">   说明正常</h2><div class="md-section-divider"></div><h3 data-anchor-id="ormo" id="编写简单的publisher和subscriber">编写简单的Publisher和Subscriber</h3><ol data-anchor-id="qzzs">
<li><p>首先，进入目录新建一个src文件夹（如果没有source先source一下） <br>
<code>mkdir -p src</code> <br>
在src文件夹内新建一个文件talker.cpp</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">cd src</span></code></li><li class="L1"><code><span class="pln">touch talker</span><span class="pun">.</span><span class="pln">cpp</span></code></li></ol></pre>

<p>在talker.cpp里面写入下面的内容</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="com">#include</span><span class="pln"> </span><span class="str">"ros/ros.h"</span><span class="com">//包括ROS中常用的公共部分的定义</span></code></li><li class="L2"><code></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="com">#include</span><span class="pln"> </span><span class="str">"std_msgs/String.h"</span><span class="com">//消息包的头文件</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">#include</span><span class="pln"> </span><span class="str">"sstream"</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="kwd">char</span><span class="pln"> </span><span class="pun">**</span><span class="pln">argv</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pun">{</span></code></li><li class="L1"><code><span class="com">//ROS初始化 将节点命名为talker</span></code></li><li class="L2"><code><span class="pln">    ros</span><span class="pun">::</span><span class="pln">init</span><span class="pun">(</span><span class="pln">argc</span><span class="pun">,</span><span class="pln">argv</span><span class="pun">,</span><span class="str">"talker"</span><span class="pun">);</span></code></li><li class="L3"><code><span class="com">//创建一个句柄到进程的节点，第一个表示初始化，最后一个NodeHandle会将所有的资源清除</span></code></li><li class="L4"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">NodeHandle</span><span class="pln"> n</span><span class="pun">;</span></code></li><li class="L5"><code><span class="com">//创建一个子类PUblish类型 叫chatter_pub 传送的信息为string类型，最多接受1000个</span></code></li><li class="L6"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">Publisher</span><span class="pln"> chatter_pub</span><span class="pun">=</span><span class="pln">n</span><span class="pun">.</span><span class="pln">advertise</span><span class="pun">&lt;</span><span class="pln">std_msgs</span><span class="pun">::</span><span class="typ">String</span><span class="pun">&gt;(</span><span class="str">"chatter"</span><span class="pun">,</span><span class="lit">1000</span><span class="pun">);</span></code></li><li class="L7"><code><span class="com">//以10HZ来运行</span></code></li><li class="L8"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">Rate</span><span class="pln"> loop_rate</span><span class="pun">(</span><span class="lit">10</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">int</span><span class="pln"> count</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L0"><code><span class="com">//当按下ctrl c时，rose：：ok()会返回false</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">ros</span><span class="pun">::</span><span class="pln">ok</span><span class="pun">())</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L3"><code><span class="com">//定义了一个要发布的msg</span></code></li><li class="L4"><code><span class="pln">        std_msgs</span><span class="pun">::</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">;</span></code></li><li class="L5"><code><span class="com">//定义一个要在终端打印出来的ss</span></code></li><li class="L6"><code><span class="pln">        std</span><span class="pun">::</span><span class="pln">stringstream ss</span><span class="pun">;</span></code></li><li class="L7"><code><span class="com">//给ss赋值</span></code></li><li class="L8"><code><span class="pln">        ss</span><span class="pun">&lt;&lt;</span><span class="str">"hello world"</span><span class="pun">&lt;&lt;</span><span class="pln">count</span><span class="pun">;</span></code></li><li class="L9"><code><span class="com">//给msg赋值，这里msg只有sting这一种类型</span></code></li><li class="L0"><code><span class="pln">        msg</span><span class="pun">.</span><span class="pln">data</span><span class="pun">=</span><span class="pln">ss</span><span class="pun">.</span><span class="pln">str</span><span class="pun">();</span></code></li><li class="L1"><code><span class="com">//ROS_INFO相当于printf</span></code></li><li class="L2"><code><span class="pln">        ROS_INFO</span><span class="pun">(</span><span class="str">"%s"</span><span class="pun">,</span><span class="pln">msg</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">c_str</span><span class="pun">());</span></code></li><li class="L3"><code><span class="com">//把消息广播给任何人</span></code></li><li class="L4"><code><span class="pln">        chatter_pub</span><span class="pun">.</span><span class="pln">publish</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></code></li><li class="L5"><code><span class="com">//回调时使用</span></code></li><li class="L6"><code><span class="pln">        ros</span><span class="pun">::</span><span class="pln">spinOnce</span><span class="pun">();</span></code></li><li class="L7"><code><span class="com">//在10hz以外的其他时间节点都是处于休眠状态的</span></code></li><li class="L8"><code><span class="pln">        loop_rate</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">        </span><span class="pun">++</span><span class="pln">count</span><span class="pun">;</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre>

<ol><li>编写Subscriber  <br>
和之前一样在src中新建一个src/listener.cpp文件 <br>
<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln"> touch listener</span><span class="pun">.</span><span class="pln">cpp</span></code></li></ol></pre></li></ol>

<p>同样我们在listener.cpp里面写入下面的代码</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">#include</span><span class="pln"> </span><span class="str">"ros/ros.h"</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">  </span><span class="com">#include</span><span class="pln"> </span><span class="str">"std_msgs/Sring.h"</span></code></li><li class="L6"><code><span class="pln">  </span><span class="com">//回调函数，在接收到消息后调用</span></code></li><li class="L7"><code><span class="pln">  </span><span class="kwd">void</span><span class="pln"> chatterCallback</span><span class="pun">(</span><span class="kwd">const</span><span class="pln"> std_msgs</span><span class="pun">::</span><span class="typ">String</span><span class="pun">::</span><span class="typ">ConstPtr</span><span class="pun">&amp;</span><span class="pln"> msg</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">  </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">      ROS_INFO</span><span class="pun">(</span><span class="str">"I heard: [%s]"</span><span class="pun">,</span><span class="pln">msg</span><span class="pun">-&gt;</span><span class="pln">data</span><span class="pun">.</span><span class="pln">c_str</span><span class="pun">())</span></code></li><li class="L0"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">  </span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="kwd">char</span><span class="pln"> </span><span class="pun">**</span><span class="pln">argv</span><span class="pun">)</span></code></li><li class="L3"><code><span class="pln">  </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">      ros</span><span class="pun">::</span><span class="pln">init</span><span class="pun">(</span><span class="pln">argc</span><span class="pun">,</span><span class="pln">argv</span><span class="pun">,</span><span class="str">"listener"</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">      ros</span><span class="pun">::</span><span class="typ">NodeHandle</span><span class="pln"> n</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">  </span><span class="com">//在接收到消息时调用chatterCallback函数</span></code></li><li class="L7"><code><span class="pln">      ros</span><span class="pun">::</span><span class="typ">Subscriber</span><span class="pln"> </span><span class="kwd">sub</span><span class="pln"> </span><span class="pun">=</span><span class="pln">n</span><span class="pun">.</span><span class="pln">subscribe</span><span class="pun">(</span><span class="str">"chatter"</span><span class="pun">,</span><span class="lit">1000</span><span class="pun">,</span><span class="pln">chatterCallback</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">  </span><span class="com">//没有接收到消息时，一直循环</span></code></li><li class="L9"><code><span class="pln">      ros</span><span class="pun">::</span><span class="pln">spin</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">  </span><span class="pun">}</span><span class="pln"> </span></code></li></ol></pre>

<p>现在万事具备，只要编译一下就好  </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">cd </span><span class="pun">~</span><span class="str">/mudu/</span></code></li><li class="L1"><code><span class="pln">catkin_make</span></code></li></ol></pre></li>
</ol><div class="md-section-divider"></div><h3 data-anchor-id="qk3j" id="执行publisher和subscriber">执行Publisher和Subscriber</h3><ul data-anchor-id="zh90">
<li><p>好,激动人心的一步到了，之前做的那么多终于要拿出来运行了 <br>
首先运行ros（这一步不成功是安装的问题，问题有很多种先百度解决）</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">roscore</span></code></li></ol></pre>

<p>打开新的终端 <br>
首先source一下然后运行程序</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">cd </span><span class="pun">~</span><span class="str">/mudu/</span></code></li><li class="L1"><code><span class="pln">source </span><span class="pun">./</span><span class="pln">devel</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash</span></code></li><li class="L2"><code><span class="pln">rosrun robot talker</span></code></li></ol></pre>

<p>运行成功的结果是这样的</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237329.554897985</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">24</span></code></li><li class="L1"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237329.654934314</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">25</span></code></li><li class="L2"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237329.754879845</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">26</span></code></li><li class="L3"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237329.854875335</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">27</span></code></li><li class="L4"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237329.954874894</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">28</span></code></li><li class="L5"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237330.055077860</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">29</span></code></li><li class="L6"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237330.154935016</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">30</span></code></li><li class="L7"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237330.254920792</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">31</span></code></li><li class="L8"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237330.354878216</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">32</span></code></li><li class="L9"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237330.454899610</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">33</span></code></li><li class="L0"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237330.554937169</span><span class="pun">]:</span><span class="pln"> hello world </span><span class="lit">34</span><span class="pln">   </span></code></li></ol></pre>

<p>运行到这都没有问题，说明已经基本成功了后面一个也是一样运行 <br>
同样新打开一个终端，source一下然后运行程序就好</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">cd </span><span class="pun">~</span><span class="str">/mudu/</span></code></li><li class="L1"><code><span class="pln">source </span><span class="pun">./</span><span class="pln">devel</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash</span></code></li><li class="L2"><code><span class="pln">rosrun robot listener</span></code></li></ol></pre>

<p>运行成功的结果如下</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237548.156052887</span><span class="pun">]:</span><span class="pln"> I heard</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hello world </span><span class="lit">2210</span><span class="pun">]</span></code></li><li class="L2"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237548.255744517</span><span class="pun">]:</span><span class="pln"> I heard</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hello world </span><span class="lit">2211</span><span class="pun">]</span></code></li><li class="L3"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237548.355945225</span><span class="pun">]:</span><span class="pln"> I heard</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hello world </span><span class="lit">2212</span><span class="pun">]</span></code></li><li class="L4"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237548.455125980</span><span class="pun">]:</span><span class="pln"> I heard</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hello world </span><span class="lit">2213</span><span class="pun">]</span></code></li><li class="L5"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237548.555806475</span><span class="pun">]:</span><span class="pln"> I heard</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hello world </span><span class="lit">2214</span><span class="pun">]</span></code></li><li class="L6"><code><span class="pun">[</span><span class="pln"> INFO</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1517237548.655804706</span><span class="pun">]:</span><span class="pln"> I heard</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">hello world </span><span class="lit">2215</span><span class="pun">]</span></code></li></ol></pre></li>
</ul><div class="md-section-divider"></div><hr><div class="md-section-divider"></div><h3 data-anchor-id="ekcx" id="编写简单的service和client">编写简单的Service和Client</h3><ul data-anchor-id="d1le">
<li><p>和上面一样我们在src文件里面新建两个文件 add_two_ints_server.cpp 和add_two_ints_client.cpp</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">   cd src</span></code></li><li class="L2"><code><span class="pln">   touch add_two_ints_server</span><span class="pun">.</span><span class="pln">cpp</span></code></li><li class="L3"><code><span class="pln">   touch add_two_ints_client</span><span class="pun">.</span><span class="pln">cpp</span></code></li></ol></pre>

<p>分别在两个文件里面粘贴下面的代码 <br>
add_two_ints_server.cpp    </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">    </span><span class="com">#include</span><span class="pln"> </span><span class="str">"ros/ros.h"</span></code></li><li class="L2"><code><span class="pln">  </span><span class="com">//之前创建的srv文件生成的头文件</span></code></li><li class="L3"><code><span class="pln">  </span><span class="com">#include</span><span class="pln"> </span><span class="str">"beginner_tutorials/AddTwoInts.h"</span></code></li><li class="L4"><code><span class="pln">  </span><span class="com">//回调函数 接收srv文件中定义的请求和响应类型，并返回一个bool值</span></code></li><li class="L5"><code><span class="pln">  </span><span class="kwd">bool</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">beginner_tutorials</span><span class="pun">::</span><span class="typ">AddTwoInts</span><span class="pun">::</span><span class="typ">Request</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">req</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">         beginner_tutorials</span><span class="pun">::</span><span class="typ">AddTwoInts</span><span class="pun">::</span><span class="typ">Response</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">res</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">  </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">    res</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">=</span><span class="pln">req</span><span class="pun">.</span><span class="pln">a</span><span class="pun">+</span><span class="pln">req</span><span class="pun">.</span><span class="pln">b</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">    ROS_INFO</span><span class="pun">(</span><span class="str">"request:x%ld,y=%ld"</span><span class="pun">,(</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">)</span><span class="pln">req</span><span class="pun">.</span><span class="pln">a</span><span class="pun">,(</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">)</span><span class="pln">req</span><span class="pun">.</span><span class="pln">b</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    ROS_INFO</span><span class="pun">(</span><span class="str">"sending back respond:[%ld]"</span><span class="pun">,(</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">)</span><span class="pln">res</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">  </span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="kwd">char</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> argv</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">  </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">    ros</span><span class="pun">::</span><span class="pln">init</span><span class="pun">(</span><span class="pln">argc</span><span class="pun">,</span><span class="pln">argv</span><span class="pun">,</span><span class="str">"add_two_ints_server"</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">NodeHandle</span><span class="pln"> n</span><span class="pun">;</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">Serviceserver</span><span class="pln"> service</span><span class="pun">=</span><span class="pln">n</span><span class="pun">.</span><span class="pln">advertiseService</span><span class="pun">(</span><span class="str">"add_two_ints"</span><span class="pun">,</span><span class="pln">add</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    ROS_INFO</span><span class="pun">(</span><span class="str">"Ready to add two ints."</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    ros</span><span class="pun">::</span><span class="pln">spin</span><span class="pun">();</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li></ol></pre>

<p>add_two_ints_client.cpp </p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">  </span><span class="com">#include</span><span class="pln"> </span><span class="str">"ros/ros.h"</span></code></li><li class="L1"><code><span class="pln">  </span><span class="com">#include</span><span class="pln"> </span><span class="str">"beginner_tutorials/AddTwoInts.h"</span></code></li><li class="L2"><code><span class="pln">  </span><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;cstdlib&gt;</span></code></li><li class="L3"><code><span class="pln">  </span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> argc</span><span class="pun">,</span><span class="kwd">char</span><span class="pln"> </span><span class="pun">**</span><span class="pln">argv</span><span class="pun">)</span></code></li><li class="L4"><code><span class="pln">  </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">    ros</span><span class="pun">::</span><span class="pln">init</span><span class="pun">(</span><span class="pln">argc</span><span class="pun">,</span><span class="pln">argv</span><span class="pun">,</span><span class="str">"add_two_ints_client"</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">argc</span><span class="pun">!=</span><span class="lit">3</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">        ROS_INFO</span><span class="pun">(</span><span class="str">"usage:add_two_ints_client X Y"</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">NodeHandle</span><span class="pln"> n</span><span class="pun">;</span></code></li><li class="L2"><code><span class="com">//创建一个客户端 该对象用于以后的回调</span></code></li><li class="L3"><code><span class="pln">    ros</span><span class="pun">::</span><span class="typ">ServiceClient</span><span class="pln"> client</span><span class="pun">=</span><span class="pln">n</span><span class="pun">.</span><span class="pln">serviceClient</span><span class="pun">&lt;</span><span class="pln">beginner_tutorials</span><span class="pun">::</span><span class="typ">AddTwoInts</span><span class="pun">&gt;</span></code></li><li class="L4"><code><span class="pln">            </span><span class="pun">(</span><span class="str">"add_two_ints"</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    beginner_tutorials</span><span class="pun">::</span><span class="typ">AddTwoInts</span><span class="pln"> srv</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    srv</span><span class="pun">.</span><span class="pln">request</span><span class="pun">.</span><span class="pln">a</span><span class="pun">=</span><span class="pln">atoll</span><span class="pun">(</span><span class="pln">argv</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]);</span></code></li><li class="L7"><code><span class="pln">    srv</span><span class="pun">.</span><span class="pln">request</span><span class="pun">.</span><span class="pln">b</span><span class="pun">=</span><span class="pln">atoll</span><span class="pun">(</span><span class="pln">argv</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">client</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">srv</span><span class="pun">))</span></code></li><li class="L9"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">        ROS_INFO</span><span class="pun">(</span><span class="str">"Sum:%ld"</span><span class="pun">,(</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">)</span><span class="pln">srv</span><span class="pun">.</span><span class="pln">response</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">else</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">        ROS_ERROR</span><span class="pun">(</span><span class="str">"Failed to call service add_two_ints"</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">  </span><span class="pun">}</span></code></li></ol></pre>

<p>最后，我们在Cmakelist里面加上这两个文件 <br>
在文件的最下面加上</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln">  add_executable</span><span class="pun">(</span><span class="pln">add_two_ints_server src</span><span class="pun">/</span><span class="pln">add_two_ints_server</span><span class="pun">.</span><span class="pln">cpp</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pln">  target_link_libraries</span><span class="pun">(</span><span class="pln">add_two_ints_server $</span><span class="pun">{</span><span class="pln">catkin_LIBRARIES</span><span class="pun">})</span></code></li><li class="L2"><code><span class="pln">  add_dependencies</span><span class="pun">(</span><span class="pln">add_two_ints_server beginner_tutorials_gencpp</span><span class="pun">)</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">  add_executable</span><span class="pun">(</span><span class="pln">add_two_ints_client src</span><span class="pun">/</span><span class="pln">add_two_ints_client</span><span class="pun">.</span><span class="pln">cpp</span><span class="pun">)</span></code></li><li class="L5"><code><span class="pln">  target_link_libraries</span><span class="pun">(</span><span class="pln">add_two_ints_client $</span><span class="pun">{</span><span class="pln">catkin_LIBRARIES</span><span class="pun">})</span></code></li><li class="L6"><code><span class="pln">  add_dependencies</span><span class="pun">(</span><span class="pln">add_two_ints_client beginner_tutorials_gencpp</span><span class="pun">)</span></code></li></ol></pre>

<p>编译一下</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code><span class="pln"> catkin_make</span></code></li></ol></pre></li>
</ul><div class="md-section-divider"></div><h3 data-anchor-id="3z3n" id="执行service和client">执行Service和Client</h3><ul data-anchor-id="0s64">
<li><p>首先，运行roscore</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">roscore</span></code></li></ol></pre>

<p>然后启动两个节点</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">   rosrun robot add_two_ints_serve  </span></code></li><li class="L2"><code><span class="pln">   rosrun robot add_two_ints_client </span><span class="lit">2</span><span class="pln"> </span><span class="lit">4</span><span class="pln">  </span></code></li></ol></pre>

<p>这两行命令必须要在两个新的终端内执行，在每个新终端都必须加上source 命令，</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code></code></li><li class="L1"><code><span class="pln">   source </span><span class="pun">./</span><span class="pln">devel</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash  </span></code></li></ol></pre>

<p>最后，如果它如愿的返回答案为6的话，那么恭喜你完成了基础部分的教学。 <br>
其实，最好的教程是官网的维基，我们的博客只能算是过来人的一种经验，后续我们继续学习move_base 包，我们一起从零开始做一个小激光slam机器人出来。</p></li>
</ul></div>
</body>
</html>